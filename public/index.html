<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Web - Sess√£o</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg,#4facfe,#00f2fe);
  color:#333;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  padding:20px;
}
h1{color:#fff;margin-bottom:20px;text-shadow:2px 2px 8px rgba(0,0,0,0.2);}
.input-group{display:flex;margin-bottom:20px;}
input#sessionName{padding:12px;font-size:16px;border-radius:8px 0 0 8px;border:none;width:250px;}
button{padding:12px 20px;font-size:16px;border-radius:0 8px 8px 0;border:none;background:#ffb347;color:#fff;cursor:pointer;}
button:hover{background:#ffcc33;}
#status{margin-top:10px;font-size:18px;font-weight:bold;color:#fff;text-shadow:1px 1px 4px rgba(0,0,0,0.3);}
#qrContainer{margin-top:20px;background:#fff;padding:20px;border-radius:16px;display:none;flex-direction:column;align-items:center;}
#qrContainer img{max-width:300px;width:100%;border-radius:12px;margin-bottom:10px;}
#sessionData{margin-top:15px;background:rgba(255,255,255,0.9);padding:12px;border-radius:12px;max-width:400px;width:100%;text-align:left;}
#logs{margin-top:20px;width:100%;max-width:500px;background:rgba(255,255,255,0.9);border-radius:12px;padding:15px;max-height:300px;overflow-y:auto;font-size:14px;line-height:1.4;}
.log-line{margin-bottom:5px;}
@media(max-width:500px){input#sessionName{width:60vw;}#qrContainer img{max-width:200px;}}
</style>
</head>
<body>
<h1>WhatsApp Web - Sess√£o</h1>

<div class="input-group">
  <input type="text" id="sessionName" placeholder="Digite o nome da sess√£o">
  <button id="startBtn">Iniciar Sess√£o</button>
</div>

<div id="status">Aguardando a√ß√£o...</div>

<div id="qrContainer">
  <img id="qrCode" src="" alt="QR Code">
</div>

<div id="sessionData"></div>

<div id="logs"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

const startBtn = document.getElementById('startBtn');
const sessionNameInput = document.getElementById('sessionName');
const logsDiv = document.getElementById('logs');
const statusDiv = document.getElementById('status');
const qrContainer = document.getElementById('qrContainer');
const qrCodeImg = document.getElementById('qrCode');
const sessionDataDiv = document.getElementById('sessionData');

function addLog(msg){
    const p=document.createElement('p');
    p.textContent=msg;
    p.className='log-line';
    logsDiv.appendChild(p);
    logsDiv.scrollTop=logsDiv.scrollHeight;
}

startBtn.addEventListener('click',()=>{
    const name=sessionNameInput.value.trim();
    if(!name)return alert('Digite o nome da sess√£o!');
    statusDiv.textContent=`Iniciando sess√£o: ${name}...`;
    addLog(`üîß Solicitando cria√ß√£o da sess√£o "${name}"...`);
    socket.emit('start-session',name);
});

socket.on('log',(msg)=>{
    addLog(msg);
    statusDiv.textContent=msg;
});

socket.on('qr',(data)=>{
    qrContainer.style.display='flex';
    qrCodeImg.src=data.qr;
    addLog(`[${data.session}] QR code atualizado (${data.attempt}/10)`);
});

socket.on('session-data',(data)=>{
    sessionDataDiv.innerHTML=`
        <strong>üìå Sess√£o Ativa: ${data.session}</strong><br>
        Status: ${data.status}<br>
        Pushname: ${data.pushname||'N/A'}<br>
        Me: ${data.me||'N/A'}<br>
        Wid: ${data.wid||'N/A'}
    `;
    addLog(`[${data.session}] Sess√£o conectada com sucesso!`);
});

socket.on('session-ended',(data)=>{
    addLog(`‚ùå Sess√£o "${data.session}" finalizada: ${data.reason}`);
    sessionDataDiv.innerHTML=`<strong>‚ùå Sess√£o ${data.session} encerrada</strong>`;
    qrContainer.style.display='none';
});
</script>
</body>
</html>
